# Foci-counter
A tool to count foci in a cell using DBSCAN

This is a Python script which should be run with the liraries described in the .py file. It first generates 3D image sets that simulate the contents of a cell where a marker stains various biological compartments such as p-bodies, and then counts the foci in each cell. The script produces:
1.  a set of 70 (or as desired) image sets of 100 .tif black-and-white images which stacked would create spherical, gradient-intensity spheres mimicking foci in a 3D space of a cell (included in this repository from one run). Note: when running the script, you may need to choose a new folder each time as default to avoid writing folders on top of existing folders for "cells", which raises errors.
2.  an output file called "data.csv" which stores the pixel intensity values for each sphere in each folder representative of a cell (also included here in the repository).
3.  a second output file called "sphere prediction.xlsx" which stores all prediction results, showing the Cell id, the actual sphere number as was generated and the predicted sphere number, as generated by a DBSCAN modelling.
This repository stores a few of those folders, where the names include the serial number of the folder and the number of foci genereted within them
(serial;spheres format), because of storage limitations.
4. Optional, the user can generate 3D visualizations of selected cells based on the name of the folder in which images were stored.
<br >
<br >

![3D visualization](https://github.com/neomaster117/Foci-counter/assets/47111504/899f805c-1458-4a2c-a755-48ad51b8cd6d)
<br >
<br >
<br >
Here, in this example with 78 spheres, the user can zoom in and find the coordinats of the spheres, as well as their relative size, based on how many pixels each sphere contains (this is a 100x scaled down visualization).

Importantly, the user must beforehand create a main experimental folder with two subfolders: 
- Cells, where the user will deposit separate folders contaning the image files for each cell (or generate them using the script provided here), and
- Outputs, where files with the results will be saved.
The user will then change the "Spheres counting" provosiry title with the experimental folder name, and the Drive from G to the user chosen drive.


Context:

Many times in working with more modern microscopy images, we are faced with the difficult task of counting how many foci wof a certain fluorescent marker there are in a 3D scan of a cell. Technologies like Super-resolution, light-sheet microscopy and spinning disk microscopes are now able to give us 3D data with many layers, in opposition to the older, traditional confocal microscopes. It is habitual to resort to flattening the 3D image to a 2d format, where there are simple plug-ins that can generate automated foci counting. Aother means include expensive proprietary technologies such as the one from Imaris.

I develloped a pipeline to create virtual data by generating spheres randomly in a 3d space of 100 stacks, which is a reasonable amount to get to some kind of data about foci in a 3D cell scan, and a second pipeline to train using the most effective machine learning algorhytm. Kmeans clustering with the elbow method worked decently up until about 50 foci, after which it becan to under-represent known values for generated spheres.

The DBSCAN model accurately and quickly guessed the number of spheres in each of the 70 cells I generated, with foci numbers between 2 and 150. Higher numbers may not be often found within the smace of a cell, however the model may also work if tested.

As for the accuracy of the generation of spheres, it was determined in another repository, where I created the images and then assessed their random nature and count by merging the images and cby counting manually the spheres after generating them:
(insert future link here).



Of course, the scope of this script is to actually predict foci numbers in actual biological data. For that reason, the foci generation section of this script becomes not needed. Just insert into the Cells folder separate folders containing separate stacks of your 3D image, and the script will treat them the same way as it did the artificial foci. The script includes a thrsholding step, where pixel valus under 100 ar considered background. For further information on the way imaging data is scanned here, I again urge you to look at my other repository, where I highlight the process of generating and scanning data: 
insert new link........
